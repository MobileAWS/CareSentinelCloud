<% headers = ['Device Name', 'Device Site'] %>
<%= CSV.generate_line headers %>
<% @devices.each do |d| %>
    <%= CSV.generate_line([d.name, d.site.name]) %>
    <% properties = d.properties.select(:key, :metric, :value)
       headers = ['Device Properties'] %>
        <%= CSV.generate_line headers %>
        <% headers = ['Name', 'Metric', 'Value'] %>
        <%= CSV.generate_line headers %>
    <% properties.each do |p| %>
        <%= CSV.generate_line([p.key, p.metric, p.value]) %>
    <% end %>
<% end %>